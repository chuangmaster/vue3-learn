<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>06 - Vue 3 é€²éšç‰¹æ€§</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c3e50;
        }
        .example {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #8e44ad;
            border-radius: 5px;
            background: #faf5ff;
        }
        .code {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 0.9em;
        }
        button {
            background: #8e44ad;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #7d3c98;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
        }
        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .tip-box {
            background: #e8f4fd;
            border: 1px solid #b3d7ff;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .feature-demo {
            border: 2px dashed #8e44ad;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: #fcf3ff;
        }
        .theme-light {
            background: #fff;
            color: #333;
        }
        .theme-dark {
            background: #2c3e50;
            color: #ecf0f1;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
        }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            font-size: 1.2em;
            color: #666;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8e44ad;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .nested-component {
            margin: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f8f9fa;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ç¬¬å…­èª²ï¼šVue 3 é€²éšç‰¹æ€§</h1>
        
        <h2>ğŸ¯ å­¸ç¿’ç›®æ¨™</h2>
        <p>é€™ä¸€èª²æˆ‘å€‘å°‡å­¸ç¿’ Vue 3 çš„é«˜ç´šç‰¹æ€§ï¼ŒåŒ…æ‹¬ä¾è³´æ³¨å…¥ã€Fragmentã€Teleportã€Suspense ç­‰ã€‚</p>

        <!-- ç¯„ä¾‹ 1: Provide / Inject -->
        <div class="example">
            <h3>ç¯„ä¾‹ 1ï¼šProvide / Inject - è·¨å±¤ç´šæ•¸æ“šå‚³é</h3>
            <div class="feature-demo">
                <div id="app1"></div>
            </div>
            <div class="code">
// ç¥–çˆ¶çµ„ä»¶
setup() {
  const theme = ref('light')
  const user = reactive({
    name: 'Vue 3 User',
    role: 'Developer'
  })
  
  // æä¾›æ•¸æ“šçµ¦å¾Œä»£çµ„ä»¶
  provide('theme', theme)
  provide('user', user)
  
  return { theme, user }
}

// å­å­«çµ„ä»¶ï¼ˆç„¡è«–å¤šæ·±å±¤ç´šï¼‰
setup() {
  // æ³¨å…¥ç¥–å…ˆæä¾›çš„æ•¸æ“š
  const theme = inject('theme')
  const user = inject('user')
  
  // å¯ä»¥æä¾›é»˜èªå€¼
  const config = inject('config', { language: 'zh-TW' })
  
  return { theme, user, config }
}</div>
            
            <div class="tip-box">
                <strong>ğŸ’¡ ä½¿ç”¨å ´æ™¯ï¼š</strong>ä¸»é¡Œç®¡ç†ã€ç”¨æˆ¶ä¿¡æ¯ã€åœ‹éš›åŒ–é…ç½®ç­‰è·¨çµ„ä»¶å…±äº«çš„æ•¸æ“šã€‚
            </div>
        </div>

        <!-- ç¯„ä¾‹ 2: Fragment - å¤šæ ¹ç¯€é» -->
        <div class="example">
            <h3>ç¯„ä¾‹ 2ï¼šFragment - å¤šæ ¹ç¯€é»çµ„ä»¶</h3>
            <div class="feature-demo">
                <div id="app2"></div>
            </div>
            <div class="code">
// Vue 3 æ”¯æŒå¤šæ ¹ç¯€é»çµ„ä»¶
const MultiRootComponent = {
  template: `
    <header>é€™æ˜¯æ¨™é¡Œ</header>
    <main>é€™æ˜¯ä¸»è¦å…§å®¹</main>
    <footer>é€™æ˜¯åº•éƒ¨</footer>
  `
}

// Vue 2 ä¸­å¿…é ˆæœ‰ä¸€å€‹æ ¹å…ƒç´ ï¼š
// <div>
//   <header>...</header>
//   <main>...</main>
//   <footer>...</footer>
// </div></div>
            
            <div class="highlight">
                <strong>âœ¨ Fragment å„ªå‹¢ï¼š</strong>æ¸›å°‘ä¸å¿…è¦çš„åŒ…è£¹å…ƒç´ ï¼Œè®“ DOM çµæ§‹æ›´èªç¾©åŒ–ï¼
            </div>
        </div>

        <!-- ç¯„ä¾‹ 3: Teleport - å‚³é€é–€ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 3ï¼šTeleport - å…ƒç´ å‚³é€</h3>
            <div class="feature-demo">
                <div id="app3"></div>
            </div>
            <div class="code">
// ä½¿ç”¨ Teleport å°‡å…§å®¹æ¸²æŸ“åˆ°å…¶ä»–ä½ç½®
template: `
  <div>
    <button @click="showModal = true">æ‰“é–‹ Modal</button>
    
    <!-- å°‡ Modal å…§å®¹å‚³é€åˆ° body -->
    <Teleport to="body">
      <div v-if="showModal" class="modal-overlay" @click="showModal = false">
        <div class="modal-content" @click.stop>
          <h3>ğŸ“¢ é€™æ˜¯ä¸€å€‹ Modal</h3>
          <p>é€™å€‹ Modal æ˜¯é€šé Teleport æ¸²æŸ“åˆ° body å…ƒç´ çš„</p>
          <button @click="showModal = false">é—œé–‰</button>
        </div>
      </div>
    </Teleport>
  </div>
`</div>
            
            <div style="margin-top: 20px;">
                <!-- Teleport ç›®æ¨™ä½ç½®æœƒåœ¨é€™è£¡ -->
                <div id="modal-container"></div>
            </div>
        </div>

        <!-- ç¯„ä¾‹ 4: Suspense - ç•°æ­¥çµ„ä»¶ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 4ï¼šSuspense - ç•°æ­¥çµ„ä»¶åŠ è¼‰</h3>
            <div class="feature-demo">
                <div id="app4"></div>
            </div>
            <div class="code">
// ç•°æ­¥çµ„ä»¶
const AsyncComponent = Vue.defineAsyncComponent({
  loader: () => {
    return new Promise((resolve) => {
      // æ¨¡æ“¬ç•°æ­¥åŠ è¼‰
      setTimeout(() => {
        resolve({
          template: `
            <div>
              <h4>ğŸ‰ ç•°æ­¥çµ„ä»¶åŠ è¼‰å®Œæˆï¼</h4>
              <p>é€™å€‹çµ„ä»¶æ˜¯ç•°æ­¥åŠ è¼‰çš„</p>
            </div>
          `
        })
      }, 2000)
    })
  },
  loadingComponent: {
    template: '<div class="loading">â³ çµ„ä»¶è¼‰å…¥ä¸­...</div>'
  },
  errorComponent: {
    template: '<div class="error">âŒ çµ„ä»¶è¼‰å…¥å¤±æ•—</div>'
  },
  timeout: 5000
})

// ä½¿ç”¨ Suspense
template: `
  <Suspense>
    <template #default>
      <async-component />
    </template>
    <template #fallback>
      <div class="loading">
        <div class="spinner"></div>
        è¼‰å…¥ä¸­...
      </div>
    </template>
  </Suspense>
`</div>
        </div>

        <!-- ç¯„ä¾‹ 5: Composition API é«˜ç´šæ¨¡å¼ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 5ï¼šComposition API é«˜ç´šæ¨¡å¼</h3>
            <div class="feature-demo">
                <div id="app5"></div>
            </div>
            <div class="code">
// ä½¿ç”¨ setup() çš„è¿”å›å‡½æ•¸æ¨¡å¼
setup(props, { emit, slots, attrs }) {
  const count = ref(0)
  
  // è¿”å›æ¸²æŸ“å‡½æ•¸
  return () => Vue.h('div', [
    Vue.h('p', `è¨ˆæ•¸: ${count.value}`),
    Vue.h('button', {
      onClick: () => count.value++
    }, '+1')
  ])
}

// ä¹Ÿå¯ä»¥è¿”å› JSXï¼ˆéœ€è¦é…ç½®ï¼‰
setup() {
  const count = ref(0)
  
  return () => (
    <div>
      <p>è¨ˆæ•¸: {count.value}</p>
      <button onClick={() => count.value++}>+1</button>
    </div>
  )
}</div>
        </div>

        <!-- ç¯„ä¾‹ 6: å…¨å±€ API è®Šæ›´ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 6ï¼šå…¨å±€ API çš„è®Šæ›´</h3>
            <div class="feature-demo">
                <div id="app6"></div>
            </div>
            <div class="code">
// Vue 2 å…¨å±€ API
Vue.component('my-component', { ... })
Vue.directive('my-directive', { ... })
Vue.mixin({ ... })
Vue.use(plugin)

// Vue 3 æ‡‰ç”¨å¯¦ä¾‹ API  
const app = createApp({})
app.component('my-component', { ... })
app.directive('my-directive', { ... })
app.mixin({ ... })
app.use(plugin)

// å¥½è™•ï¼šä¸åŒæ‡‰ç”¨å¯¦ä¾‹ä¹‹é–“ç›¸äº’éš”é›¢</div>
            
            <div class="highlight">
                <strong>ğŸ”§ API è®ŠåŒ–çš„å¥½è™•ï¼š</strong><br>
                â€¢ æ‡‰ç”¨å¯¦ä¾‹éš”é›¢ï¼Œé¿å…å…¨å±€æ±¡æŸ“<br>
                â€¢ æ›´å¥½çš„ tree-shaking æ”¯æŒ<br>
                â€¢ TypeScript é¡å‹æ”¯æŒæ›´å¼·
            </div>
        </div>

        <!-- ç¯„ä¾‹ 7: éŸ¿æ‡‰å¼é€²éšç”¨æ³• -->
        <div class="example">
            <h3>ç¯„ä¾‹ 7ï¼šéŸ¿æ‡‰å¼ API é€²éšç”¨æ³•</h3>
            <div class="feature-demo">
                <div id="app7"></div>
            </div>
            <div class="code">
import { 
  ref, reactive, readonly, shallowRef, shallowReactive,
  markRaw, toRaw, isRef, isReactive, isReadonly
} from 'vue'

setup() {
  // readonly åªè®€ä»£ç†
  const state = reactive({ count: 0 })
  const readonlyState = readonly(state)
  
  // shallow æ·ºå±¤éŸ¿æ‡‰å¼
  const shallowObj = shallowReactive({
    count: 0,
    nested: { value: 1 }  // åµŒå¥—å°è±¡ä¸éŸ¿æ‡‰å¼
  })
  
  // markRaw æ¨™è¨˜ç‚ºééŸ¿æ‡‰å¼
  const rawObj = markRaw({ heavy: 'data' })
  
  // toRaw ç²å–åŸå§‹å°è±¡
  const raw = toRaw(state)
  
  return {
    state,
    readonlyState,
    shallowObj,
    rawObj
  }
}</div>
        </div>

        <!-- ç¯„ä¾‹ 8: è‡ªå®šç¾©æŒ‡ä»¤ v3 -->
        <div class="example">
            <h3>ç¯„ä¾‹ 8ï¼šVue 3 è‡ªå®šç¾©æŒ‡ä»¤</h3>
            <div class="feature-demo">
                <div id="app8"></div>
            </div>
            <div class="code">
// Vue 3 æŒ‡ä»¤é‰¤å­å‡½æ•¸åç¨±è®Šæ›´
const focusDirective = {
  // Vue 2: bind, inserted, update, componentUpdated, unbind
  // Vue 3: created, beforeMount, mounted, beforeUpdate, updated, beforeUnmount, unmounted
  
  mounted(el, binding) {
    el.focus()
  },
  
  updated(el, binding) {
    if (binding.value !== binding.oldValue) {
      el.style.backgroundColor = binding.value
    }
  }
}

// è¨»å†ŠæŒ‡ä»¤
app.directive('focus', focusDirective)

// ä½¿ç”¨
template: `<input v-focus="backgroundColor" />`</div>
        </div>

        <h2>ğŸ”„ å¾ Vue 2 é·ç§»çš„é—œéµè®ŠåŒ–</h2>
        
        <div class="tip-box">
            <h3>ğŸ“‹ é‡è¦è®Šæ›´ç¸½çµ</h3>
            <ul>
                <li><strong>å…¨å±€ API</strong>ï¼šå¾ Vue å…¨å±€å°è±¡æ”¹ç‚ºæ‡‰ç”¨å¯¦ä¾‹</li>
                <li><strong>ç”Ÿå‘½é€±æœŸ</strong>ï¼šbeforeDestroy â†’ beforeUnmountï¼Œdestroyed â†’ unmounted</li>
                <li><strong>æŒ‡ä»¤é‰¤å­</strong>ï¼šèˆ‡çµ„ä»¶ç”Ÿå‘½é€±æœŸä¿æŒä¸€è‡´</li>
                <li><strong>v-model</strong>ï¼šæ”¯æŒå¤šå€‹ v-modelï¼Œè‡ªå®šç¾©ä¿®é£¾ç¬¦</li>
                <li><strong>Fragment</strong>ï¼šæ”¯æŒå¤šæ ¹ç¯€é»çµ„ä»¶</li>
                <li><strong>Teleport</strong>ï¼šæ›¿ä»£ Vue 2 çš„ Portal</li>
                <li><strong>Suspense</strong>ï¼šåŸç”Ÿç•°æ­¥çµ„ä»¶æ”¯æŒ</li>
            </ul>
        </div>

        <h2>ğŸ› ï¸ å¯¦éš›é–‹ç™¼å»ºè­°</h2>

        <div class="highlight">
            <h3>ğŸ’¡ æœ€ä½³å¯¦è¸</h3>
            <ul>
                <li><strong>æ¼¸é€²å¼é·ç§»</strong>ï¼šVue 3 æ”¯æŒé¸é …å¼ APIï¼Œå¯æ¼¸é€²å¼æ¡ç”¨çµ„åˆå¼ API</li>
                <li><strong>TypeScript å„ªå…ˆ</strong>ï¼šVue 3 å° TypeScript æ”¯æŒæ›´å¥½</li>
                <li><strong>çµ„åˆå¼å„ªå…ˆ</strong>ï¼šæ–°é …ç›®å»ºè­°ä½¿ç”¨ Composition API</li>
                <li><strong>éŸ¿æ‡‰å¼å„ªåŒ–</strong>ï¼šåˆç†ä½¿ç”¨ shallowã€readonly ç­‰ API å„ªåŒ–æ€§èƒ½</li>
                <li><strong>Teleport æ‡‰ç”¨</strong>ï¼šModalã€Toastã€Tooltip ç­‰ä½¿ç”¨ Teleport</li>
            </ul>
        </div>

        <h2>ğŸ“– é‡é»ç¸½çµ</h2>
        <ul>
            <li><strong>Provide/Inject</strong>ï¼šè·¨å±¤ç´šæ•¸æ“šå…±äº«ï¼Œé¿å… prop drilling</li>
            <li><strong>Fragment</strong>ï¼šå¤šæ ¹ç¯€é»çµ„ä»¶ï¼Œæ›´èªç¾©åŒ–çš„ DOM</li>
            <li><strong>Teleport</strong>ï¼šå°‡çµ„ä»¶å…§å®¹æ¸²æŸ“åˆ°ä»»æ„ DOM ä½ç½®</li>
            <li><strong>Suspense</strong>ï¼šå„ªé›…è™•ç†ç•°æ­¥çµ„ä»¶åŠ è¼‰ç‹€æ…‹</li>
            <li><strong>æ€§èƒ½æ”¹é€²</strong>ï¼šæ›´å°çš„åŒ…é«”ç©ï¼Œæ›´å¿«çš„é‹è¡Œé€Ÿåº¦</li>
        </ul>

        <h2>ğŸ¯ å­¸ç¿’å®Œæˆï¼</h2>
        <p>æ­å–œä½ å®Œæˆäº† Vue 3 é€²éšç‰¹æ€§çš„å­¸ç¿’ï¼ç¾åœ¨ä½ å·²ç¶“æŒæ¡äº†ï¼š</p>
        <ul>
            <li><a href="01-basic-composition-api.html">âœ… åŸºç¤ Composition API</a></li>
            <li><a href="02-reactive-refs.html">âœ… éŸ¿æ‡‰å¼ç³»çµ±</a></li>
            <li><a href="03-computed-watch.html">âœ… è¨ˆç®—å±¬æ€§èˆ‡ç›£è½å™¨</a></li>
            <li><a href="04-lifecycle.html">âœ… ç”Ÿå‘½é€±æœŸé‰¤å­</a></li>
            <li><a href="05-composables.html">âœ… Composables é€²éš</a></li>
            <li><strong>âœ… é€²éšç‰¹æ€§ï¼ˆç•¶å‰ï¼‰</strong></li>
        </ul>
        
        <h2>ğŸ¯ ä¸‹ä¸€æ­¥</h2>
        <ul>
            <li><a href="05-composables.html">â† ä¸Šä¸€èª²ï¼šComposables é€²éš</a></li>
            <li><a href="07-script-setup.html">ä¸‹ä¸€èª²ï¼šScript Setup èªæ³•ç³– â†’</a></li>
        </ul>
        
        <div class="highlight">
            <strong>ğŸš€ å®Œæˆæ‰€æœ‰èª²ç¨‹å¾Œçš„å»ºè­°ï¼š</strong><br>
            â€¢ å‰µå»ºä¸€å€‹çœŸå¯¦é …ç›®ç·´ç¿’é€™äº›æ¦‚å¿µ<br>
            â€¢ æ¢ç´¢ Vue 3 ç”Ÿæ…‹ç³»çµ±ï¼ˆPiniaã€Vue Router 4ã€VueUseï¼‰<br>    
            â€¢ å­¸ç¿’èˆ‡å…¶ä»–æ¡†æ¶çš„æ•´åˆï¼ˆNuxt 3ã€Viteï¼‰
        </div>
    </div>

    <script>
        const { createApp, ref, reactive, provide, inject, defineAsyncComponent, Teleport, Suspense, readonly, h } = Vue
        
        // ç¯„ä¾‹ 1: Provide/Inject
        createApp({
            template: `
                <div :class="'theme-' + theme">
                    <h4>ğŸ¨ ä¸»é¡Œç®¡ç†ç³»çµ±</h4>
                    <p>ç•¶å‰ä¸»é¡Œï¼š{{ theme }}</p>
                    <p>ç”¨æˆ¶ï¼š{{ user.name }} ({{ user.role }})</p>
                    
                    <button @click="toggleTheme">åˆ‡æ›ä¸»é¡Œ</button>
                    <button @click="user.name = user.name === 'Vue 3 User' ? 'Alice' : 'Vue 3 User'">
                        åˆ‡æ›ç”¨æˆ¶
                    </button>
                    
                    <div class="nested-component">
                        <h5>ğŸ“¦ å­çµ„ä»¶</h5>
                        <child-component />
                    </div>
                </div>
            `,
            setup() {
                const theme = ref('light')
                const user = reactive({
                    name: 'Vue 3 User',
                    role: 'Developer'
                })
                
                function toggleTheme() {
                    theme.value = theme.value === 'light' ? 'dark' : 'light'
                }
                
                provide('theme', theme)
                provide('user', readonly(user))
                provide('api', {
                    updateUser: (name) => {
                        user.name = name
                    }
                })
                
                return { theme, user, toggleTheme }
            },
            components: {
                'child-component': {
                    template: `
                        <div :class="'theme-' + theme">
                            <p>å­çµ„ä»¶æ¥æ”¶åˆ°çš„ä¸»é¡Œï¼š{{ theme }}</p>
                            <p>ç”¨æˆ¶åï¼š{{ user.name }}</p>
                            <grandchild-component />
                        </div>
                    `,
                    setup() {
                        const theme = inject('theme')
                        const user = inject('user')
                        return { theme, user }
                    },
                    components: {
                        'grandchild-component': {
                            template: `
                                <div class="nested-component">
                                    <h6>ğŸ“¦ å­«å­çµ„ä»¶</h6>
                                    <p>æ·±å±¤çµ„ä»¶ä¹Ÿèƒ½ç²å–ï¼š{{ theme }} ä¸»é¡Œ</p>
                                    <p>é…ç½®èªè¨€ï¼š{{ config.language }}</p>
                                    <button @click="api.updateUser('å¾å­«å­çµ„ä»¶æ›´æ–°')">
                                        å¾å­«å­çµ„ä»¶æ›´æ–°ç”¨æˆ¶
                                    </button>
                                </div>
                            `,
                            setup() {
                                const theme = inject('theme')
                                const config = inject('config', { language: 'zh-TW' })
                                const api = inject('api')
                                return { theme, config, api }
                            }
                        }
                    }
                }
            }
        }).mount('#app1')
        
        // ç¯„ä¾‹ 2: Fragment
        createApp({
            template: `
                <div>
                    <h4>ğŸ“„ Fragment æ¼”ç¤º</h4>
                    <p>ä¸‹é¢çš„çµ„ä»¶æœ‰å¤šå€‹æ ¹ç¯€é»ï¼š</p>
                    <multi-root-component />
                </div>
            `,
            components: {
                'multi-root-component': {
                    template: `
                        <header style="background: #e8f4fd; padding: 10px; border-radius: 4px; margin: 5px 0;">
                            ğŸ“° é€™æ˜¯æ¨™é¡Œ
                        </header>
                        <main style="background: #f0fff0; padding: 10px; border-radius: 4px; margin: 5px 0;">
                            ğŸ“ é€™æ˜¯ä¸»è¦å…§å®¹
                        </main>
                        <footer style="background: #fff3cd; padding: 10px; border-radius: 4px; margin: 5px 0;">
                            ğŸ“‹ é€™æ˜¯åº•éƒ¨ - æ³¨æ„ï¼šé€™å€‹çµ„ä»¶æœ‰ä¸‰å€‹æ ¹ç¯€é»ï¼
                        </footer>
                    `
                }
            }
        }).mount('#app2')
        
        // ç¯„ä¾‹ 3: Teleport
        createApp({
            template: `
                <div>
                    <h4>ğŸš€ Teleport å‚³é€é–€</h4>
                    <button @click="showModal = true">ğŸªŸ æ‰“é–‹ Modal</button>
                    <p><small>Modal æœƒè¢«å‚³é€åˆ° body å…ƒç´ ä¸‹</small></p>
                    
                    <Teleport to="body">
                        <div v-if="showModal" class="modal-overlay" @click="showModal = false">
                            <div class="modal-content" @click.stop>
                                <h3>ğŸ“¢ Teleport Modal</h3>
                                <p>é€™å€‹ Modal é€šé Teleport æ¸²æŸ“åˆ° body ä¸‹ï¼Œé¿å…äº† z-index å±¤ç´šå•é¡Œã€‚</p>
                                <p>é»æ“Šé®ç½©æˆ–æŒ‰éˆ•å¯ä»¥é—œé–‰ã€‚</p>
                                <button @click="showModal = false">âŒ é—œé–‰</button>
                            </div>
                        </div>
                    </Teleport>
                </div>
            `,
            setup() {
                const showModal = ref(false)
                return { showModal }
            }
        }).mount('#app3')
        
        // ç¯„ä¾‹ 4: Suspense
        createApp({
            template: `
                <div>
                    <h4>â° Suspense ç•°æ­¥çµ„ä»¶</h4>
                    <button @click="showAsync = !showAsync">
                        {{ showAsync ? 'éš±è—' : 'é¡¯ç¤º' }} ç•°æ­¥çµ„ä»¶
                    </button>
                    
                    <div v-if="showAsync">
                        <Suspense>
                            <template #default>
                                <async-component />
                            </template>
                            <template #fallback>
                                <div class="loading">
                                    <div class="spinner"></div>
                                    ç•°æ­¥çµ„ä»¶è¼‰å…¥ä¸­...
                                </div>
                            </template>
                        </Suspense>
                    </div>
                </div>
            `,
            setup() {
                const showAsync = ref(false)
                return { showAsync }
            },
            components: {
                'async-component': defineAsyncComponent({
                    loader: () => {
                        return new Promise((resolve) => {
                            setTimeout(() => {
                                resolve({
                                    template: `
                                        <div style="background: #d4edda; padding: 15px; border-radius: 4px; margin: 10px 0;">
                                            <h4>ğŸ‰ ç•°æ­¥çµ„ä»¶è¼‰å…¥å®Œæˆï¼</h4>
                                            <p>é€™å€‹çµ„ä»¶æ¨¡æ“¬äº† 2 ç§’çš„è¼‰å…¥æ™‚é–“ã€‚</p>
                                            <p>ç•¶å‰æ™‚é–“ï¼š{{ new Date().toLocaleTimeString() }}</p>
                                        </div>
                                    `,
                                    setup() {
                                        return {}
                                    }
                                })
                            }, 2000)
                        })
                    },
                    loadingComponent: {
                        template: `
                            <div class="loading">
                                <div class="spinner"></div>
                                çµ„ä»¶è¼‰å…¥ä¸­...
                            </div>
                        `
                    },
                    errorComponent: {
                        template: `
                            <div class="error">
                                âŒ çµ„ä»¶è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡è©¦
                            </div>
                        `
                    },
                    timeout: 5000
                })
            }
        }).mount('#app4')
        
        // ç¯„ä¾‹ 5: æ¸²æŸ“å‡½æ•¸
        createApp({
            template: `
                <div>
                    <h4>ğŸ”§ æ¸²æŸ“å‡½æ•¸æ¨¡å¼</h4>
                    <p>ä¸‹é¢çš„çµ„ä»¶ä½¿ç”¨æ¸²æŸ“å‡½æ•¸å‰µå»ºï¼š</p>
                    <render-function-component />
                </div>
            `,
            components: {
                'render-function-component': {
                    setup() {
                        const count = ref(0)
                        const message = ref('Hello, Render Function!')
                        
                        return () => h('div', {
                            style: {
                                background: '#f8f9fa',
                                padding: '15px',
                                borderRadius: '4px',
                                margin: '10px 0'
                            }
                        }, [
                            h('p', message.value),
                            h('p', `è¨ˆæ•¸: ${count.value}`),
                            h('button', {
                                onClick: () => count.value++,
                                style: { 
                                    background: '#8e44ad',
                                    color: 'white',
                                    border: 'none',
                                    padding: '5px 10px',
                                    borderRadius: '3px',
                                    cursor: 'pointer',
                                    marginRight: '5px'
                                }
                            }, '+1'),
                            h('button', {
                                onClick: () => {
                                    message.value = message.value === 'Hello, Render Function!'
                                        ? 'Render Function is Powerful!' 
                                        : 'Hello, Render Function!'
                                },
                                style: { 
                                    background: '#27ae60',
                                    color: 'white',
                                    border: 'none',
                                    padding: '5px 10px',
                                    borderRadius: '3px',
                                    cursor: 'pointer'
                                }
                            }, 'åˆ‡æ›ä¿¡æ¯')
                        ])
                    }
                }
            }
        }).mount('#app5')
        
        // ç¯„ä¾‹ 6: æ‡‰ç”¨å¯¦ä¾‹
        const app6 = createApp({
            template: `
                <div>
                    <h4>ğŸ”§ æ‡‰ç”¨å¯¦ä¾‹ API</h4>
                    <p>é€™å€‹æ‡‰ç”¨å¯¦ä¾‹æ¼”ç¤ºäº†çµ„ä»¶ã€æŒ‡ä»¤ã€æ··å…¥çš„è¨»å†Šï¼š</p>
                    <custom-component />
                    <input v-highlight="highlightColor" v-model="inputValue" placeholder="å¸¶é«˜äº®æŒ‡ä»¤çš„è¼¸å…¥æ¡†">
                    <p>è¼¸å…¥å€¼ï¼š{{ inputValue }}</p>
                    <p>æ··å…¥æä¾›çš„æ–¹æ³•ï¼š{{ formatMessage('Vue 3 å¾ˆæ£’ï¼') }}</p>
                    
                    <p>
                        é«˜äº®é¡è‰²ï¼š
                        <select v-model="highlightColor">
                            <option value="#fff3cd">é»ƒè‰²</option>
                            <option value="#d1ecf1">è—è‰²</option>
                            <option value="#d4edda">ç¶ è‰²</option>
                            <option value="#f8d7da">ç´…è‰²</option>
                        </select>
                    </p>
                </div>
            `,
            setup() {
                const inputValue = ref('')
                const highlightColor = ref('#fff3cd')
                return { inputValue, highlightColor }
            }
        })
        
        // è¨»å†Šçµ„ä»¶
        app6.component('custom-component', {
            template: `
                <div style="background: #e8f4fd; padding: 10px; border-radius: 4px; margin: 10px 0;">
                    <p>ğŸ“¦ é€™æ˜¯é€šé app.component() è¨»å†Šçš„çµ„ä»¶</p>
                    <p>çµ„ä»¶å¯¦ä¾‹ IDï¼š{{ $id }}</p>
                </div>
            `
        })
        
        // è¨»å†ŠæŒ‡ä»¤
        app6.directive('highlight', {
            mounted(el, binding) {
                el.style.backgroundColor = binding.value
            },
            updated(el, binding) {
                el.style.backgroundColor = binding.value
            }
        })
        
        // è¨»å†Šæ··å…¥
        app6.mixin({
            methods: {
                formatMessage(msg) {
                    return `ğŸ‰ ${msg} ğŸ‰`
                }
            }
        })
        
        app6.mount('#app6')
        
        // ç¯„ä¾‹ 7: éŸ¿æ‡‰å¼é€²éš
        createApp({
            template: `
                <div>
                    <h4>ğŸ§ª éŸ¿æ‡‰å¼ API é€²éš</h4>
                    
                    <div style="margin: 10px 0;">
                        <h5>ğŸ“ å¯å¯«ç‹€æ…‹ï¼š</h5>
                        <p>è¨ˆæ•¸ï¼š{{ state.count }}</p>
                        <button @click="state.count++">å¢åŠ </button>
                    </div>
                    
                    <div style="margin: 10px 0;">
                        <h5>ğŸ“– åªè®€ç‹€æ…‹ï¼š</h5>
                        <p>åªè®€è¨ˆæ•¸ï¼š{{ readonlyState.count }}</p>
                        <button @click="tryModifyReadonly">å˜—è©¦ä¿®æ”¹ï¼ˆæœƒå¤±æ•—ï¼‰</button>
                    </div>
                    
                    <div style="margin: 10px 0;">
                        <h5>ğŸ” æ·ºå±¤éŸ¿æ‡‰å¼ï¼š</h5>
                        <p>é ‚å±¤ï¼š{{ shallowObj.count }}</p>
                        <p>åµŒå¥—ï¼š{{ shallowObj.nested.value }}</p>
                        <button @click="shallowObj.count++">ä¿®æ”¹é ‚å±¤ï¼ˆéŸ¿æ‡‰å¼ï¼‰</button>
                        <button @click="shallowObj.nested.value++">ä¿®æ”¹åµŒå¥—ï¼ˆééŸ¿æ‡‰å¼ï¼‰</button>
                    </div>
                    
                    <div style="margin: 10px 0;">
                        <h5>ğŸ” æª¢æŸ¥å·¥å…·ï¼š</h5>
                        <p>state æ˜¯éŸ¿æ‡‰å¼ï¼Ÿ{{ isReactiveValue }}</p>
                        <p>readonlyState æ˜¯åªè®€ï¼Ÿ{{ isReadonlyValue }}</p>
                        <p>count æ˜¯ refï¼Ÿ{{ isRefValue }}</p>
                    </div>
                </div>
            `,
            setup() {
                const count = ref(0)
                const state = reactive({ count: 0 })
                const readonlyState = readonly(state)
                
                const shallowObj = Vue.shallowReactive({
                    count: 0,
                    nested: { value: 1 }
                })
                
                const isReactiveValue = Vue.isReactive(state)
                const isReadonlyValue = Vue.isReadonly(readonlyState)
                const isRefValue = Vue.isRef(count)
                
                function tryModifyReadonly() {
                    try {
                        readonlyState.count++
                        alert('ä¿®æ”¹æˆåŠŸ')
                    } catch (error) {
                        console.warn('ä¸èƒ½ä¿®æ”¹åªè®€ç‹€æ…‹:', error)
                        alert('ä¿®æ”¹å¤±æ•—ï¼šåªè®€ç‹€æ…‹ä¸èƒ½ä¿®æ”¹ï¼ˆæª¢æŸ¥æ§åˆ¶å°ï¼‰')
                    }
                }
                
                return {
                    state,
                    readonlyState,
                    shallowObj,
                    isReactiveValue,
                    isReadonlyValue,
                    isRefValue,
                    tryModifyReadonly
                }
            }
        }).mount('#app7')
        
        // ç¯„ä¾‹ 8: è‡ªå®šç¾©æŒ‡ä»¤
        const app8 = createApp({
            template: `
                <div>
                    <h4>ğŸ¨ Vue 3 è‡ªå®šç¾©æŒ‡ä»¤</h4>
                    
                    <div style="margin: 10px 0;">
                        <input v-focus v-model="text1" placeholder="è‡ªå‹•èšç„¦è¼¸å…¥æ¡†">
                    </div>
                    
                    <div style="margin: 10px 0;">
                        <input v-color-highlight="color" v-model="text2" placeholder="å‹•æ…‹èƒŒæ™¯è‰²è¼¸å…¥æ¡†">
                        <select v-model="color">
                            <option value="#fff3cd">é»ƒè‰²</option>
                            <option value="#d1ecf1">è—è‰²</option>
                            <option value="#d4edda">ç¶ è‰²</option>
                        </select>
                    </div>
                    
                    <div style="margin: 10px 0;">
                        <div v-click-outside="handleClickOutside" 
                             style="border: 2px solid #ddd; padding: 10px; background: #f8f9fa;">
                            <p>é»æ“Šé€™å€‹å€åŸŸå¤–é¢è©¦è©¦</p>
                            <p>å¤–éƒ¨é»æ“Šæ¬¡æ•¸ï¼š{{ outsideClicks }}</p>
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const text1 = ref('')
                const text2 = ref('')
                const color = ref('#fff3cd')
                const outsideClicks = ref(0)
                
                function handleClickOutside() {
                    outsideClicks.value++
                }
                
                return {
                    text1,
                    text2,
                    color,
                    outsideClicks,
                    handleClickOutside
                }
            }
        })
        
        // è‡ªå‹•èšç„¦æŒ‡ä»¤
        app8.directive('focus', {
            mounted(el) {
                el.focus()
            }
        })
        
        // å‹•æ…‹èƒŒæ™¯è‰²æŒ‡ä»¤
        app8.directive('color-highlight', {
            mounted(el, binding) {
                el.style.backgroundColor = binding.value
            },
            updated(el, binding) {
                el.style.backgroundColor = binding.value
            }
        })
        
        // å¤–éƒ¨é»æ“ŠæŒ‡ä»¤
        app8.directive('click-outside', {
            mounted(el, binding) {
                el._clickOutside = (event) => {
                    if (!(el === event.target || el.contains(event.target))) {
                        binding.value()
                    }
                }
                document.addEventListener('click', el._clickOutside)
            },
            beforeUnmount(el) {
                document.removeEventListener('click', el._clickOutside)
            }
        })
        
        app8.mount('#app8')
    </script>
</body>
</html>