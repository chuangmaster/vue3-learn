<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>02 - éŸ¿æ‡‰å¼ç³»çµ±èˆ‡ Refs</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c3e50;
        }
        .example {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #27ae60;
            border-radius: 5px;
            background: #f0fff0;
        }
        .code {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #229954;
        }
        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 8px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .warning {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 8px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info-box {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ç¬¬äºŒèª²ï¼šéŸ¿æ‡‰å¼ç³»çµ±èˆ‡ Refs</h1>
        
        <h2>ğŸ” æ·±å…¥ç†è§£ Vue 3 çš„éŸ¿æ‡‰å¼ç³»çµ±</h2>
        <p>Vue 3 çš„éŸ¿æ‡‰å¼ç³»çµ±æ˜¯åŸºæ–¼ Proxy çš„ï¼Œæä¾›äº†æ›´å¼·å¤§å’Œéˆæ´»çš„éŸ¿æ‡‰å¼èƒ½åŠ›ã€‚</p>
        
        <!-- ç¯„ä¾‹ 1ï¼šref vs reactive -->
        <div class="example">
            <h3>ç¯„ä¾‹ 1ï¼šref() vs reactive() çš„å€åˆ¥</h3>
            <div id="app1"></div>
            <div class="code">
// ref() - ç”¨æ–¼åŸºæœ¬æ•¸æ“šé¡å‹
const count = ref(0)           // æ•¸å­—
const message = ref('Hello')   // å­—ç¬¦ä¸²
const isVisible = ref(true)    // å¸ƒçˆ¾å€¼

// reactive() - ç”¨æ–¼å°è±¡å’Œæ•¸çµ„
const state = reactive({
  count: 0,
  user: {
    name: 'å°æ˜',
    age: 25
  },
  numbers: [1, 2, 3]
})

// è¨ªå•æ–¹å¼çš„å·®ç•°
console.log(count.value)       // ref éœ€è¦ .value
console.log(state.count)       // reactive ç›´æ¥è¨ªå•</div>
            
            <div class="highlight">
                <strong>ğŸ’¡ ä½•æ™‚ä½¿ç”¨ ref() vs reactive()ï¼Ÿ</strong><br>
                â€¢ <strong>ref()</strong>ï¼šåŸºæœ¬æ•¸æ“šé¡å‹ï¼ˆstring, number, booleanï¼‰<br>
                â€¢ <strong>reactive()</strong>ï¼šå°è±¡å’Œæ•¸çµ„
            </div>
        </div>
        
        <!-- ç¯„ä¾‹ 2ï¼šéŸ¿æ‡‰å¼çš„æ·±å±¤ç†è§£ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 2ï¼šéŸ¿æ‡‰å¼çš„å·¥ä½œåŸç†</h3>
            <div id="app2"></div>
            <div class="code">
setup() {
  const count = ref(0)
  const state = reactive({
    name: 'Vue 3',
    features: ['Composition API', 'TypeScript', 'Performance']
  })
  
  // ä¿®æ”¹æœƒè§¸ç™¼ç•Œé¢æ›´æ–°
  function updateCount() {
    count.value++  // ğŸ”„ éŸ¿æ‡‰å¼æ›´æ–°
  }
  
  function addFeature() {
    state.features.push('New Feature!')  // ğŸ”„ éŸ¿æ‡‰å¼æ›´æ–°
  }
}</div>
            
            <div class="info-box">
                <strong>ğŸ” å¹•å¾ŒåŸç†ï¼š</strong>Vue 3 ä½¿ç”¨ Proxy ä¾†æ””æˆªå°è±¡çš„è®€å–å’Œä¿®æ”¹æ“ä½œï¼Œç•¶æ•¸æ“šç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œæœƒè‡ªå‹•æ›´æ–°æ‰€æœ‰ä¾è³´è©²æ•¸æ“šçš„çµ„ä»¶ã€‚
            </div>
        </div>
        
        <!-- ç¯„ä¾‹ 3ï¼šåµŒå¥—å°è±¡çš„éŸ¿æ‡‰å¼ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 3ï¼šåµŒå¥—å°è±¡çš„éŸ¿æ‡‰å¼è™•ç†</h3>
            <div id="app3"></div>
            <div class="code">
setup() {
  const user = reactive({
    info: {
      name: 'å¼µä¸‰',
      age: 30,
      address: {
        city: 'å°åŒ—',
        street: 'ä¿¡ç¾©è·¯'
      }
    },
    hobbies: ['è®€æ›¸', 'æ¸¸æ³³']
  })
  
  // æ·±å±¤åµŒå¥—çš„ä¿®æ”¹ä¹Ÿæ˜¯éŸ¿æ‡‰å¼çš„
  function updateCity() {
    user.info.address.city = 'é«˜é›„'  // âœ… éŸ¿æ‡‰å¼
  }
  
  function addHobby() {
    user.hobbies.push('é¨è»Š')  // âœ… éŸ¿æ‡‰å¼
  }
}</div>
            
            <div class="highlight">
                <strong>âœ¨ Vue 3 çš„å„ªå‹¢ï¼š</strong>ç„¡è«–å°è±¡åµŒå¥—å¤šæ·±ï¼Œæ‰€æœ‰å±¤ç´šçš„è®ŠåŒ–éƒ½æ˜¯éŸ¿æ‡‰å¼çš„ï¼
            </div>
        </div>
        
        <!-- ç¯„ä¾‹ 4ï¼šéŸ¿æ‡‰å¼çš„æ³¨æ„äº‹é … -->
        <div class="example">
            <h3>ç¯„ä¾‹ 4ï¼šå¸¸è¦‹é™·é˜±èˆ‡è§£æ±ºæ–¹æ¡ˆ</h3>
            <div id="app4"></div>
            <div class="code">
setup() {
  const state = reactive({ count: 0 })
  
  // âŒ éŒ¯èª¤ï¼šå¤±å»éŸ¿æ‡‰å¼
  let { count } = state
  count++  // é€™ä¸æœƒè§¸ç™¼æ›´æ–°ï¼
  
  // âœ… æ­£ç¢ºï¼šä¿æŒéŸ¿æ‡‰å¼
  function increment() {
    state.count++  // ç›´æ¥ä¿®æ”¹åŸå°è±¡
  }
  
  // âœ… ä½¿ç”¨ toRefs è§£æ§‹
  const { count: reactiveCount } = toRefs(state)
  // ç¾åœ¨ reactiveCount æ˜¯éŸ¿æ‡‰å¼çš„
}</div>
            
            <div class="warning">
                <strong>âš ï¸ é‡è¦æé†’ï¼š</strong>è§£æ§‹ reactive å°è±¡æœƒå¤±å»éŸ¿æ‡‰å¼ï¼ä½¿ç”¨ toRefs() ä¾†å®‰å…¨è§£æ§‹ã€‚
            </div>
        </div>
        
        <!-- ç¯„ä¾‹ 5ï¼štoRefs çš„ä½¿ç”¨ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 5ï¼štoRefs è®“è§£æ§‹ä¿æŒéŸ¿æ‡‰å¼</h3>
            <div id="app5"></div>
            <div class="code">
import { reactive, toRefs } from 'vue'

setup() {
  const state = reactive({
    firstName: 'ç‹',
    lastName: 'å°è¯',
    age: 28
  })
  
  // ä½¿ç”¨ toRefs å®‰å…¨è§£æ§‹
  const { firstName, lastName, age } = toRefs(state)
  
  // ç¾åœ¨é€™äº›éƒ½ä¿æŒéŸ¿æ‡‰å¼
  function updateName() {
    firstName.value = 'æ'  // æ³¨æ„ï¼štoRefs å¾Œéœ€è¦ .value
    lastName.value = 'å°ç¾'
  }
  
  return {
    firstName,
    lastName, 
    age,
    updateName
  }
}</div>
        </div>
        
        <!-- ç¯„ä¾‹ 6ï¼šisRef å’Œ unref å·¥å…· -->
        <div class="example">
            <h3>ç¯„ä¾‹ 6ï¼šéŸ¿æ‡‰å¼å·¥å…·å‡½æ•¸</h3>
            <div id="app6"></div>
            <div class="code">
import { ref, isRef, unref } from 'vue'

setup() {
  const count = ref(0)
  const regularVar = 42
  
  function checkTypes() {
    console.log('count æ˜¯ refï¼Ÿ', isRef(count))        // true
    console.log('regularVar æ˜¯ refï¼Ÿ', isRef(regularVar)) // false
    
    // unref: å¦‚æœæ˜¯ ref å‰‡è¿”å› .valueï¼Œå¦å‰‡è¿”å›åŸå€¼
    console.log('count çš„å€¼ï¼š', unref(count))      // 0
    console.log('regularVar çš„å€¼ï¼š', unref(regularVar)) // 42
  }
  
  return { count, checkTypes }
}</div>
            
            <div class="info-box">
                <strong>ğŸ› ï¸ å·¥å…·å‡½æ•¸å€‘ï¼š</strong><br>
                â€¢ <code>isRef()</code>ï¼šæª¢æŸ¥æ˜¯å¦ç‚º ref<br>
                â€¢ <code>unref()</code>ï¼šå®‰å…¨ç²å–å€¼ï¼ˆref æˆ–æ™®é€šå€¼ï¼‰<br>
                â€¢ <code>toRefs()</code>ï¼šå°‡ reactive å°è±¡è½‰ç‚º ref å°è±¡
            </div>
        </div>
        
        <h2>ğŸ“– é‡é»ç¸½çµ</h2>
        <ul>
            <li><strong>ref()</strong>ï¼šåŸºæœ¬æ•¸æ“šé¡å‹çš„éŸ¿æ‡‰å¼åŒ…è£</li>
            <li><strong>reactive()</strong>ï¼šå°è±¡å’Œæ•¸çµ„çš„éŸ¿æ‡‰å¼ä»£ç†</li>
            <li><strong>.value</strong>ï¼šè¨ªå• ref å€¼çš„æ–¹å¼</li>
            <li><strong>toRefs()</strong>ï¼šå®‰å…¨è§£æ§‹ reactive å°è±¡</li>
            <li><strong>æ·±åº¦éŸ¿æ‡‰å¼</strong>ï¼šåµŒå¥—å°è±¡è‡ªå‹•éŸ¿æ‡‰å¼</li>
        </ul>
        
        <h2>ğŸ¯ ä¸‹ä¸€æ­¥</h2>
        <p>ç¾åœ¨ä½ å·²ç¶“æŒæ¡äº†éŸ¿æ‡‰å¼ç³»çµ±ï¼æ¥ä¸‹ä¾†å­¸ç¿’ï¼š</p>
        <ul>
            <li><a href="01-basic-composition-api.html">â† ä¸Šä¸€èª²ï¼šåŸºç¤ Composition API</a></li>
            <li><a href="03-computed-watch.html">ä¸‹ä¸€èª²ï¼šè¨ˆç®—å±¬æ€§èˆ‡ç›£è½å™¨ â†’</a></li>
        </ul>
    </div>

    <script>
        const { createApp, ref, reactive, toRefs, isRef, unref } = Vue
        
        // ç¯„ä¾‹ 1ï¼šref vs reactive
        createApp({
            template: `
                <div>
                    <h4>ref() ç¯„ä¾‹ï¼š</h4>
                    <p>è¨ˆæ•¸ (ref): {{ refCount }}</p>
                    <button @click="refCount++">å¢åŠ  ref è¨ˆæ•¸</button>
                    
                    <h4>reactive() ç¯„ä¾‹ï¼š</h4>
                    <p>è¨ˆæ•¸ (reactive): {{ reactiveState.count }}</p>
                    <p>ç”¨æˆ¶: {{ reactiveState.user.name }} ({{ reactiveState.user.age }}æ­²)</p>
                    <button @click="reactiveState.count++">å¢åŠ  reactive è¨ˆæ•¸</button>
                    <button @click="reactiveState.user.age++">å¢åŠ å¹´é½¡</button>
                </div>
            `,
            setup() {
                // ref ç¯„ä¾‹
                const refCount = ref(0)
                
                // reactive ç¯„ä¾‹
                const reactiveState = reactive({
                    count: 0,
                    user: {
                        name: 'å°æ˜',
                        age: 25
                    }
                })
                
                return {
                    refCount,
                    reactiveState
                }
            }
        }).mount('#app1')
        
        // ç¯„ä¾‹ 2ï¼šéŸ¿æ‡‰å¼æ›´æ–°
        createApp({
            template: `
                <div>
                    <h4>éŸ¿æ‡‰å¼è¨ˆæ•¸å™¨ï¼š{{ count }}</h4>
                    <button @click="updateCount">é»æˆ‘å¢åŠ </button>
                    
                    <h4>{{ state.name }} ç‰¹æ€§ï¼š</h4>
                    <ul>
                        <li v-for="feature in state.features" :key="feature">{{ feature }}</li>
                    </ul>
                    <button @click="addFeature">æ·»åŠ ç‰¹æ€§</button>
                </div>
            `,
            setup() {
                const count = ref(0)
                const state = reactive({
                    name: 'Vue 3',
                    features: ['Composition API', 'TypeScript', 'Performance']
                })
                
                function updateCount() {
                    count.value++
                    console.log('è¨ˆæ•¸æ›´æ–°ç‚ºï¼š', count.value)
                }
                
                function addFeature() {
                    const features = ['Tree-shaking', 'Fragments', 'Portals', 'Suspense']
                    const randomFeature = features[Math.floor(Math.random() * features.length)]
                    if (!state.features.includes(randomFeature)) {
                        state.features.push(randomFeature)
                    }
                }
                
                return {
                    count,
                    state,
                    updateCount,
                    addFeature
                }
            }
        }).mount('#app2')
        
        // ç¯„ä¾‹ 3ï¼šåµŒå¥—å°è±¡
        createApp({
            template: `
                <div>
                    <h4>ç”¨æˆ¶è³‡è¨Šï¼š</h4>
                    <p>å§“åï¼š{{ user.info.name }}</p>
                    <p>å¹´é½¡ï¼š{{ user.info.age }}</p>
                    <p>åœ°å€ï¼š{{ user.info.address.city }}, {{ user.info.address.street }}</p>
                    <p>æ„›å¥½ï¼š{{ user.hobbies.join(', ') }}</p>
                    
                    <button @click="updateCity">æ¬åˆ°é«˜é›„</button>
                    <button @click="addHobby">æ·»åŠ æ„›å¥½</button>
                    <button @click="haveBirthday">éç”Ÿæ—¥</button>
                </div>
            `,
            setup() {
                const user = reactive({
                    info: {
                        name: 'å¼µä¸‰',
                        age: 30,
                        address: {
                            city: 'å°åŒ—',
                            street: 'ä¿¡ç¾©è·¯'
                        }
                    },
                    hobbies: ['è®€æ›¸', 'æ¸¸æ³³']
                })
                
                function updateCity() {
                    user.info.address.city = user.info.address.city === 'å°åŒ—' ? 'é«˜é›„' : 'å°åŒ—'
                }
                
                function addHobby() {
                    const hobbies = ['é¨è»Š', 'ç™»å±±', 'æ”å½±', 'çƒ¹é£ª', 'ç¹ªç•«']
                    const newHobby = hobbies[Math.floor(Math.random() * hobbies.length)]
                    if (!user.hobbies.includes(newHobby)) {
                        user.hobbies.push(newHobby)
                    }
                }
                
                function haveBirthday() {
                    user.info.age++
                }
                
                return {
                    user,
                    updateCity,
                    addHobby,
                    haveBirthday
                }
            }
        }).mount('#app3')
        
        // ç¯„ä¾‹ 4ï¼šéŸ¿æ‡‰å¼é™·é˜±
        createApp({
            template: `
                <div>
                    <h4>æ­£ç¢ºçš„éŸ¿æ‡‰å¼æ›´æ–°ï¼š</h4>
                    <p>è¨ˆæ•¸ï¼š{{ state.count }}</p>
                    <button @click="increment">æ­£ç¢ºå¢åŠ </button>
                    <button @click="wrongIncrement">éŒ¯èª¤å¢åŠ ï¼ˆç„¡æ•ˆï¼‰</button>
                    <p><small>æ‰“é–‹ç€è¦½å™¨æ§åˆ¶å°æŸ¥çœ‹éŒ¯èª¤ç¤ºä¾‹çš„log</small></p>
                </div>
            `,
            setup() {
                const state = reactive({ count: 0 })
                
                // éŒ¯èª¤çš„è§£æ§‹æ–¹å¼
                let { count } = state  // å¤±å»éŸ¿æ‡‰å¼
                
                function increment() {
                    state.count++  // âœ… æ­£ç¢º
                }
                
                function wrongIncrement() {
                    count++  // âŒ ä¸æœƒè§¸ç™¼æ›´æ–°
                    console.log('å±€éƒ¨è®Šæ•¸ countï¼š', count)
                    console.log('éŸ¿æ‡‰å¼ state.countï¼š', state.count)
                }
                
                return {
                    state,
                    increment,
                    wrongIncrement
                }
            }
        }).mount('#app4')
        
        // ç¯„ä¾‹ 5ï¼štoRefs ä½¿ç”¨
        createApp({
            template: `
                <div>
                    <h4>ä½¿ç”¨ toRefs å®‰å…¨è§£æ§‹ï¼š</h4>
                    <p>å§“åï¼š{{ firstName }} {{ lastName }}</p>
                    <p>å¹´é½¡ï¼š{{ age }}</p>
                    <button @click="updateName">æ›´æ›å§“å</button>
                    <button @click="age++">å¹´é½¡+1</button>
                </div>
            `,
            setup() {
                const state = reactive({
                    firstName: 'ç‹',
                    lastName: 'å°è¯',
                    age: 28
                })
                
                // ä½¿ç”¨ toRefs å®‰å…¨è§£æ§‹
                const { firstName, lastName, age } = toRefs(state)
                
                function updateName() {
                    const names = [
                        ['æ', 'å°ç¾'], 
                        ['é™³', 'å¤§æ˜'], 
                        ['æ—', 'å°èŠ±'],
                        ['ç‹', 'å°è¯']  // åŸå§‹åå­—
                    ]
                    const randomName = names[Math.floor(Math.random() * names.length)]
                    firstName.value = randomName[0]
                    lastName.value = randomName[1]
                }
                
                return {
                    firstName,
                    lastName,
                    age,
                    updateName
                }
            }
        }).mount('#app5')
        
        // ç¯„ä¾‹ 6ï¼šå·¥å…·å‡½æ•¸
        createApp({
            template: `
                <div>
                    <h4>éŸ¿æ‡‰å¼å·¥å…·å‡½æ•¸æ¸¬è©¦ï¼š</h4>
                    <p>ref è¨ˆæ•¸ï¼š{{ count }}</p>
                    <p>æ™®é€šè®Šæ•¸ï¼š{{ regularVar }}</p>
                    <button @click="checkTypes">æª¢æŸ¥é¡å‹ä¸¦è¨˜éŒ„</button>
                    <button @click="count++">å¢åŠ è¨ˆæ•¸</button>
                    <p><small>æ‰“é–‹ç€è¦½å™¨æ§åˆ¶å°æŸ¥çœ‹ log</small></p>
                </div>
            `,
            setup() {
                const count = ref(0)
                const regularVar = 42
                
                function checkTypes() {
                    console.log('=== é¡å‹æª¢æŸ¥ ===')
                    console.log('count æ˜¯ refï¼Ÿ', isRef(count))
                    console.log('regularVar æ˜¯ refï¼Ÿ', isRef(regularVar))
                    console.log('count çš„å€¼ï¼ˆunrefï¼‰ï¼š', unref(count))
                    console.log('regularVar çš„å€¼ï¼ˆunrefï¼‰ï¼š', unref(regularVar))
                    console.log('count.valueï¼š', count.value)
                }
                
                return {
                    count,
                    regularVar,
                    checkTypes
                }
            }
        }).mount('#app6')
    </script>
</body>
</html>