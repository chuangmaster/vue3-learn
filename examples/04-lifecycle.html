<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>04 - ç”Ÿå‘½é€±æœŸé‰¤å­</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #2c3e50;
        }
        .example {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #e67e22;
            border-radius: 5px;
            background: #fef9e7;
        }
        .code {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        button {
            background: #e67e22;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #d68910;
        }
        .lifecycle-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
        }
        .log-mount { color: #28a745; }
        .log-update { color: #007bff; }
        .log-unmount { color: #dc3545; }
        .log-effect { color: #6f42c1; }
        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 8px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info-box {
            background: #e8f4fd;
            border: 1px solid #b3d7ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .comparison-table th {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ ç¬¬å››èª²ï¼šç”Ÿå‘½é€±æœŸé‰¤å­</h1>
        
        <h2>ğŸ¯ ä»€éº¼æ˜¯ç”Ÿå‘½é€±æœŸï¼Ÿ</h2>
        <p>ç”Ÿå‘½é€±æœŸé‰¤å­è®“ä½ åœ¨çµ„ä»¶çš„ä¸åŒéšæ®µåŸ·è¡Œä»£ç¢¼ï¼Œæ¯”å¦‚çµ„ä»¶å‰µå»ºã€æ›è¼‰ã€æ›´æ–°ã€éŠ·æ¯€ç­‰æ™‚æ©Ÿã€‚</p>
        
        <!-- ç”Ÿå‘½é€±æœŸå°æ¯”è¡¨ -->
        <div class="info-box">
            <h3>ğŸ“Š Options API vs Composition API å°æ¯”</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Options API</th>
                        <th>Composition API</th>
                        <th>åŸ·è¡Œæ™‚æ©Ÿ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>beforeCreate</td>
                        <td>-</td>
                        <td>setup() æœ¬èº«å°±ç›¸ç•¶æ–¼ beforeCreate</td>
                    </tr>
                    <tr>
                        <td>created</td>
                        <td>-</td>
                        <td>setup() æœ¬èº«å°±ç›¸ç•¶æ–¼ created</td>
                    </tr>
                    <tr>
                        <td>beforeMount</td>
                        <td>onBeforeMount</td>
                        <td>DOM æ›è¼‰å‰</td>
                    </tr>
                    <tr>
                        <td>mounted</td>
                        <td>onMounted</td>
                        <td>DOM æ›è¼‰å¾Œ</td>
                    </tr>
                    <tr>
                        <td>beforeUpdate</td>
                        <td>onBeforeUpdate</td>
                        <td>éŸ¿æ‡‰å¼æ•¸æ“šè®ŠåŒ–ï¼ŒDOM æ›´æ–°å‰</td>
                    </tr>
                    <tr>
                        <td>updated</td>
                        <td>onUpdated</td>
                        <td>DOM æ›´æ–°å¾Œ</td>
                    </tr>
                    <tr>
                        <td>beforeUnmount</td>
                        <td>onBeforeUnmount</td>
                        <td>çµ„ä»¶å¸è¼‰å‰</td>
                    </tr>
                    <tr>
                        <td>unmounted</td>
                        <td>onUnmounted</td>
                        <td>çµ„ä»¶å¸è¼‰å¾Œ</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- ç¯„ä¾‹ 1ï¼šåŸºæœ¬ç”Ÿå‘½é€±æœŸ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 1ï¼šåŸºæœ¬ç”Ÿå‘½é€±æœŸé‰¤å­</h3>
            <div id="app1"></div>
            <div class="code">
import { 
  ref, 
  onBeforeMount, 
  onMounted, 
  onBeforeUpdate, 
  onUpdated,
  onBeforeUnmount,
  onUnmounted
} from 'vue'

setup() {
  const count = ref(0)
  
  onBeforeMount(() => {
    console.log('ğŸ“ onBeforeMount: æº–å‚™æ›è¼‰åˆ° DOM')
  })
  
  onMounted(() => {
    console.log('âœ… onMounted: å·²æ›è¼‰åˆ° DOMï¼Œå¯ä»¥è¨ªå• DOM å…ƒç´ ')
  })
  
  onBeforeUpdate(() => {
    console.log('ğŸ”„ onBeforeUpdate: æ•¸æ“šæ›´æ–°ï¼ŒDOM é‡æ–°æ¸²æŸ“å‰')
  })
  
  onUpdated(() => {
    console.log('âœ¨ onUpdated: DOM å·²æ›´æ–°')
  })
  
  return { count }
}</div>
        </div>
        
        <!-- ç¯„ä¾‹ 2ï¼šå¯¦éš›æ‡‰ç”¨å ´æ™¯ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 2ï¼šå¸¸è¦‹æ‡‰ç”¨å ´æ™¯</h3>
            <div id="app2"></div>
            <div class="code">
setup() {
  const windowSize = ref({ width: 0, height: 0 })
  
  // æ›´æ–°è¦–çª—å¤§å°
  function updateWindowSize() {
    windowSize.value = {
      width: window.innerWidth,
      height: window.innerHeight
    }
  }
  
  onMounted(() => {
    // çµ„ä»¶æ›è¼‰å¾Œï¼šæ·»åŠ äº‹ä»¶ç›£è½ã€åˆå§‹åŒ–ç¬¬ä¸‰æ–¹åº«
    updateWindowSize()
    window.addEventListener('resize', updateWindowSize)
    console.log('âœ… äº‹ä»¶ç›£è½å™¨å·²æ·»åŠ ')
  })
  
  onUnmounted(() => {
    // çµ„ä»¶å¸è¼‰å‰ï¼šæ¸…ç†äº‹ä»¶ç›£è½ã€æ¸…é™¤å®šæ™‚å™¨
    window.removeEventListener('resize', updateWindowSize)
    console.log('ğŸ§¹ äº‹ä»¶ç›£è½å™¨å·²æ¸…ç†')
  })
  
  return { windowSize }
}</div>
        </div>
        
        <!-- ç¯„ä¾‹ 3ï¼šå®šæ™‚å™¨ç®¡ç† -->
        <div class="example">
            <h3>ç¯„ä¾‹ 3ï¼šå®šæ™‚å™¨çš„æ­£ç¢ºç®¡ç†</h3>
            <div id="app3"></div>
            <div class="code">
setup() {
  const time = ref(new Date())
  const isRunning = ref(true)
  let timer = null
  
  onMounted(() => {
    // å•Ÿå‹•å®šæ™‚å™¨
    timer = setInterval(() => {
      if (isRunning.value) {
        time.value = new Date()
      }
    }, 1000)
    console.log('â° å®šæ™‚å™¨å·²å•Ÿå‹•')
  })
  
  onUnmounted(() => {
    // æ¸…ç†å®šæ™‚å™¨ - éå¸¸é‡è¦ï¼
    if (timer) {
      clearInterval(timer)
      console.log('â¹ï¸ å®šæ™‚å™¨å·²æ¸…ç†')
    }
  })
  
  return { time, isRunning }
}</div>
            
            <div class="highlight">
                <strong>ğŸ’¡ é‡è¦ï¼š</strong>åœ¨ onUnmounted ä¸­æ¸…ç†å®šæ™‚å™¨ã€äº‹ä»¶ç›£è½å™¨ç­‰ï¼Œé¿å…å…§å­˜æ´©æ¼ï¼
            </div>
        </div>
        
        <!-- ç¯„ä¾‹ 4ï¼šAPI æ•¸æ“šåŠ è¼‰ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 4ï¼šAPI æ•¸æ“šåŠ è¼‰æœ€ä½³å¯¦è¸</h3>
            <div id="app4"></div>
            <div class="code">
setup() {
  const users = ref([])
  const loading = ref(false)
  const error = ref(null)
  
  async function fetchUsers() {
    loading.value = true
    error.value = null
    
    try {
      // æ¨¡æ“¬ API èª¿ç”¨
      await new Promise(resolve => setTimeout(resolve, 1500))
      
      // æ¨¡æ“¬æ•¸æ“š
      users.value = [
        { id: 1, name: 'å¼µå°æ˜', email: 'zhang@example.com' },
        { id: 2, name: 'æå°è¯', email: 'li@example.com' },
        { id: 3, name: 'ç‹å°ç¾', email: 'wang@example.com' }
      ]
    } catch (err) {
      error.value = 'è¼‰å…¥å¤±æ•—'
    } finally {
      loading.value = false
    }
  }
  
  // çµ„ä»¶æ›è¼‰å¾Œè‡ªå‹•è¼‰å…¥æ•¸æ“š
  onMounted(() => {
    fetchUsers()
    console.log('ğŸ“Š é–‹å§‹è¼‰å…¥ç”¨æˆ¶æ•¸æ“š')
  })
  
  return { users, loading, error, fetchUsers }
}</div>
        </div>
        
        <!-- ç¯„ä¾‹ 5ï¼šçµ„ä»¶çš„æ›è¼‰å’Œå¸è¼‰ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 5ï¼šå‹•æ…‹çµ„ä»¶çš„ç”Ÿå‘½é€±æœŸ</h3>
            <div id="app5"></div>
            <div class="code">
// å­çµ„ä»¶çš„ç”Ÿå‘½é€±æœŸ
const ChildComponent = {
  setup() {
    const count = ref(0)
    const logs = inject('logs')
    
    onBeforeMount(() => {
      logs.value.push('ğŸ”µ å­çµ„ä»¶ï¼šæº–å‚™æ›è¼‰')
    })
    
    onMounted(() => {
      logs.value.push('âœ… å­çµ„ä»¶ï¼šå·²æ›è¼‰')
    })
    
    onBeforeUnmount(() => {
      logs.value.push('ğŸ”¶ å­çµ„ä»¶ï¼šæº–å‚™å¸è¼‰')
    })
    
    onUnmounted(() => {
      logs.value.push('âŒ å­çµ„ä»¶ï¼šå·²å¸è¼‰')
    })
    
    return { count }
  }
}</div>
        </div>
        
        <!-- ç¯„ä¾‹ 6ï¼šç”Ÿå‘½é€±æœŸçš„çµ„åˆä½¿ç”¨ -->
        <div class="example">
            <h3>ç¯„ä¾‹ 6ï¼šè¤‡é›œå ´æ™¯çš„ç”Ÿå‘½é€±æœŸçµ„åˆ</h3>
            <div id="app6"></div>
            <div class="code">
setup() {
  const data = ref([])
  const socket = ref(null)
  const isOnline = ref(navigator.onLine)
  
  // ç¶²è·¯ç‹€æ…‹ç›£æ§
  function handleOnline() { isOnline.value = true }
  function handleOffline() { isOnline.value = false }
  
  onMounted(async () => {
    // 1. æ·»åŠ ç¶²è·¯ç›£è½
    window.addEventListener('online', handleOnline)
    window.addEventListener('offline', handleOffline)
    
    // 2. åˆå§‹åŒ– WebSocketï¼ˆæ¨¡æ“¬ï¼‰
    console.log('ğŸ”Œ WebSocket é€£æ¥å·²å»ºç«‹')
    
    // 3. è¼‰å…¥åˆå§‹æ•¸æ“š
    await loadData()
  })
  
  onUpdated(() => {
    // DOM æ›´æ–°å¾Œçš„è™•ç†
    console.log('ğŸ“± UI å·²æ›´æ–°ï¼Œæ•¸æ“šé …ç›®æ•¸:', data.value.length)
  })
  
  onUnmounted(() => {
    // æ¸…ç†æ‰€æœ‰è³‡æº
    window.removeEventListener('online', handleOnline)
    window.removeEventListener('offline', handleOffline)
    
    if (socket.value) {
      socket.value.close()
      console.log('ğŸ”Œ WebSocket é€£æ¥å·²é—œé–‰')
    }
  })
  
  return { data, isOnline }
}</code>
        </div>
        
        <h2>ğŸ“– é‡é»ç¸½çµ</h2>
        <ul>
            <li><strong>onMounted</strong>ï¼šDOM æ›è¼‰å¾Œï¼Œé©åˆåˆå§‹åŒ–ç¬¬ä¸‰æ–¹åº«ã€API èª¿ç”¨</li>
            <li><strong>onUnmounted</strong>ï¼šçµ„ä»¶éŠ·æ¯€å‰ï¼Œå¿…é ˆæ¸…ç†è³‡æº</li>
            <li><strong>onUpdated</strong>ï¼šDOM æ›´æ–°å¾Œï¼Œæ³¨æ„é¿å…ç„¡é™å¾ªç’°</li>
            <li><strong>æ¸…ç†å·¥ä½œ</strong>ï¼šå®šæ™‚å™¨ã€äº‹ä»¶ç›£è½ã€WebSocket ç­‰å¿…é ˆæ¸…ç†</li>
        </ul>
        
        <div class="highlight">
            <strong>âš ï¸ å¸¸è¦‹é™·é˜±ï¼š</strong><br>
            â€¢ å¿˜è¨˜æ¸…ç†å®šæ™‚å™¨å’Œäº‹ä»¶ç›£è½å™¨<br>
            â€¢ åœ¨ onUpdated ä¸­ä¿®æ”¹éŸ¿æ‡‰å¼æ•¸æ“šé€ æˆç„¡é™å¾ªç’°<br>
            â€¢ ç•°æ­¥æ“ä½œæ²’æœ‰è€ƒæ…®çµ„ä»¶å·²å¸è¼‰çš„æƒ…æ³
        </div>
        
        <h2>ğŸ¯ ä¸‹ä¸€æ­¥</h2>
        <ul>
            <li><a href="03-computed-watch.html">â† ä¸Šä¸€èª²ï¼šè¨ˆç®—å±¬æ€§èˆ‡ç›£è½å™¨</a></li>
            <li><a href="05-composables.html">ä¸‹ä¸€èª²ï¼šComposables æ·±å…¥ â†’</a></li>        
        </ul>
    </div>

    <script>
        const { 
            createApp, 
            ref, 
            reactive,
            onBeforeMount, 
            onMounted, 
            onBeforeUpdate, 
            onUpdated,
            onBeforeUnmount,
            onUnmounted,
            provide,
            inject
        } = Vue
        
        // ç¯„ä¾‹ 1ï¼šåŸºæœ¬ç”Ÿå‘½é€±æœŸ
        createApp({
            template: `
                <div>
                    <h4>ç”Ÿå‘½é€±æœŸæ¼”ç¤º</h4>
                    <p>è¨ˆæ•¸ï¼š{{ count }}</p>
                    <button @click="count++">å¢åŠ è¨ˆæ•¸ (è§¸ç™¼æ›´æ–°)</button>
                    <div class="lifecycle-log">
                        <div v-for="log in logs" :key="log" class="log-entry" :class="getLogClass(log)">
                            {{ log }}
                        </div>
                    </div>
                    <p><small>æ‰“é–‹æ§åˆ¶å°æŸ¥çœ‹è©³ç´°ç”Ÿå‘½é€±æœŸ log</small></p>
                </div>
            `,
            setup() {
                const count = ref(0)
                const logs = ref([])
                
                function addLog(message, type = '') {
                    const timestamp = new Date().toLocaleTimeString()
                    logs.value.unshift(`[${timestamp}] ${message}`)
                    if (logs.value.length > 10) {
                        logs.value = logs.value.slice(0, 10)
                    }
                }
                
                function getLogClass(log) {
                    if (log.includes('Mount')) return 'log-mount'
                    if (log.includes('Update')) return 'log-update'
                    if (log.includes('Unmount')) return 'log-unmount'
                    return ''
                }
                
                onBeforeMount(() => {
                    console.log('ğŸ“ onBeforeMount: æº–å‚™æ›è¼‰åˆ° DOM')
                    addLog('ğŸ“ onBeforeMount: æº–å‚™æ›è¼‰')
                })
                
                onMounted(() => {
                    console.log('âœ… onMounted: å·²æ›è¼‰åˆ° DOM')
                    addLog('âœ… onMounted: çµ„ä»¶å·²æ›è¼‰')
                })
                
                onBeforeUpdate(() => {
                    console.log('ğŸ”„ onBeforeUpdate: DOM æ›´æ–°å‰')
                    addLog('ğŸ”„ onBeforeUpdate: æº–å‚™æ›´æ–° DOM')
                })
                
                onUpdated(() => {
                    console.log('âœ¨ onUpdated: DOM å·²æ›´æ–°')
                    addLog('âœ¨ onUpdated: DOM æ›´æ–°å®Œæˆ')
                })
                
                return { count, logs, getLogClass }
            }
        }).mount('#app1')
        
        // ç¯„ä¾‹ 2ï¼šè¦–çª—å¤§å°ç›£è½
        createApp({
            template: `
                <div>
                    <h4>è¦–çª—å¤§å°ç›£è½</h4>
                    <p>è¦–çª—å¤§å°ï¼š{{ windowSize.width }} Ã— {{ windowSize.height }}</p>
                    <p><small>èª¿æ•´ç€è¦½å™¨è¦–çª—å¤§å°è©¦è©¦</small></p>
                    <div class="lifecycle-log">
                        <div v-for="log in logs" :key="log" class="log-entry">{{ log }}</div>
                    </div>
                </div>
            `,
            setup() {
                const windowSize = ref({ width: 0, height: 0 })
                const logs = ref([])
                
                function addLog(message) {
                    const timestamp = new Date().toLocaleTimeString()
                    logs.value.unshift(`[${timestamp}] ${message}`)
                    if (logs.value.length > 8) {
                        logs.value = logs.value.slice(0, 8)
                    }
                }
                
                function updateWindowSize() {
                    windowSize.value = {
                        width: window.innerWidth,
                        height: window.innerHeight
                    }
                    addLog(`è¦–çª—å¤§å°: ${windowSize.value.width}Ã—${windowSize.value.height}`)
                }
                
                onMounted(() => {
                    updateWindowSize()
                    window.addEventListener('resize', updateWindowSize)
                    addLog('âœ… è¦–çª—ç›£è½å™¨å·²æ·»åŠ ')
                    console.log('âœ… äº‹ä»¶ç›£è½å™¨å·²æ·»åŠ ')
                })
                
                onUnmounted(() => {
                    window.removeEventListener('resize', updateWindowSize)
                    addLog('ğŸ§¹ è¦–çª—ç›£è½å™¨å·²æ¸…ç†')
                    console.log('ğŸ§¹ äº‹ä»¶ç›£è½å™¨å·²æ¸…ç†')
                })
                
                return { windowSize, logs }
            }
        }).mount('#app2')
        
        // ç¯„ä¾‹ 3ï¼šå®šæ™‚å™¨ç®¡ç†
        createApp({
            template: `
                <div>
                    <h4>å¯¦æ™‚æ™‚é˜</h4>
                    <p style="font-size: 1.2em; font-family: monospace;">{{ formatTime(time) }}</p>
                    <p>
                        <button @click="isRunning = !isRunning">
                            {{ isRunning ? 'â¸ï¸ æš«åœ' : 'â–¶ï¸ ç¹¼çºŒ' }}
                        </button>
                    </p>
                    <p>ç‹€æ…‹ï¼š{{ isRunning ? 'ğŸŸ¢ é‹è¡Œä¸­' : 'ğŸ”´ å·²æš«åœ' }}</p>
                </div>
            `,
            setup() {
                const time = ref(new Date())
                const isRunning = ref(true)
                let timer = null
                
                function formatTime(date) {
                    return date.toLocaleTimeString('zh-TW', {
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    })
                }
                
                onMounted(() => {
                    timer = setInterval(() => {
                        if (isRunning.value) {
                            time.value = new Date()
                        }
                    }, 1000)
                    console.log('â° æ™‚é˜å®šæ™‚å™¨å·²å•Ÿå‹•')
                })
                
                onUnmounted(() => {
                    if (timer) {
                        clearInterval(timer)
                        console.log('â¹ï¸ æ™‚é˜å®šæ™‚å™¨å·²æ¸…ç†')
                    }
                })
                
                return { time, isRunning, formatTime }
            }
        }).mount('#app3')
        
        // ç¯„ä¾‹ 4ï¼šAPI æ•¸æ“šåŠ è¼‰
        createApp({
            template: `
                <div>
                    <h4>ç”¨æˆ¶æ•¸æ“šåŠ è¼‰</h4>
                    <button @click="fetchUsers" :disabled="loading">
                        {{ loading ? 'â³ è¼‰å…¥ä¸­...' : 'ğŸ”„ é‡æ–°è¼‰å…¥' }}
                    </button>
                    
                    <div v-if="error" style="color: red; margin: 10px 0;">
                        âŒ {{ error }}
                    </div>
                    
                    <div v-if="loading" style="margin: 10px 0;">
                        <span>ğŸ“¡ æ­£åœ¨è¼‰å…¥ç”¨æˆ¶æ•¸æ“š...</span>
                    </div>
                    
                    <div v-if="!loading && users.length > 0">
                        <h5>ğŸ“‹ ç”¨æˆ¶åˆ—è¡¨ï¼š</h5>
                        <ul>
                            <li v-for="user in users" :key="user.id">
                                {{ user.name }} ({{ user.email }})
                            </li>
                        </ul>
                    </div>
                </div>
            `,
            setup() {
                const users = ref([])
                const loading = ref(false)
                const error = ref(null)
                
                async function fetchUsers() {
                    loading.value = true
                    error.value = null
                    
                    try {
                        console.log('ğŸ“Š é–‹å§‹è¼‰å…¥ç”¨æˆ¶æ•¸æ“š')
                        
                        // æ¨¡æ“¬ API å»¶é²
                        await new Promise(resolve => setTimeout(resolve, 1500))
                        
                        // éš¨æ©Ÿæ±ºå®šæ˜¯å¦æˆåŠŸ
                        if (Math.random() > 0.8) {
                            throw new Error('ç¶²è·¯éŒ¯èª¤')
                        }
                        
                        // æ¨¡æ“¬æ•¸æ“š
                        users.value = [
                            { id: 1, name: 'å¼µå°æ˜', email: 'zhang@example.com' },
                            { id: 2, name: 'æå°è¯', email: 'li@example.com' },
                            { id: 3, name: 'ç‹å°ç¾', email: 'wang@example.com' },
                            { id: 4, name: 'é™³å¤§é›„', email: 'chen@example.com' }
                        ]
                        
                        console.log('âœ… ç”¨æˆ¶æ•¸æ“šè¼‰å…¥å®Œæˆ', users.value)
                    } catch (err) {
                        error.value = 'è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦'
                        console.error('âŒ è¼‰å…¥ç”¨æˆ¶æ•¸æ“šå¤±æ•—:', err)
                    } finally {
                        loading.value = false
                    }
                }
                
                onMounted(() => {
                    fetchUsers()
                })
                
                return { users, loading, error, fetchUsers }
            }
        }).mount('#app4')
        
        // ç¯„ä¾‹ 5ï¼šå‹•æ…‹çµ„ä»¶
        createApp({
            template: `
                <div>
                    <h4>å‹•æ…‹çµ„ä»¶ç”Ÿå‘½é€±æœŸ</h4>
                    <button @click="showChild = !showChild">
                        {{ showChild ? 'âŒ ç§»é™¤å­çµ„ä»¶' : 'âœ… é¡¯ç¤ºå­çµ„ä»¶' }}
                    </button>
                    
                    <div v-if="showChild" style="border: 1px solid #ddd; padding: 10px; margin: 10px 0;">
                        <child-component></child-component>
                    </div>
                    
                    <div class="lifecycle-log">
                        <h5>ç”Ÿå‘½é€±æœŸæ—¥èªŒï¼š</h5>
                        <div v-for="log in logs.slice().reverse()" :key="log" class="log-entry">
                            {{ log }}
                        </div>
                    </div>
                </div>
            `,
            setup() {
                const showChild = ref(false)
                const logs = ref([])
                
                provide('logs', logs)
                
                return { showChild, logs }
            },
            components: {
                'child-component': {
                    template: `
                        <div>
                            <h5>ğŸ§© å­çµ„ä»¶</h5>
                            <p>è¨ˆæ•¸ï¼š{{ count }}</p>
                            <button @click="count++">+1</button>
                        </div>
                    `,
                    setup() {
                        const count = ref(0)
                        const logs = inject('logs')
                        
                        function addLog(message) {
                            const timestamp = new Date().toLocaleTimeString()
                            logs.value.push(`[${timestamp}] ${message}`)
                        }
                        
                        onBeforeMount(() => {
                            addLog('ğŸ”µ å­çµ„ä»¶ï¼šæº–å‚™æ›è¼‰')
                        })
                        
                        onMounted(() => {
                            addLog('âœ… å­çµ„ä»¶ï¼šå·²æ›è¼‰')
                        })
                        
                        onBeforeUpdate(() => {
                            addLog('ğŸ”„ å­çµ„ä»¶ï¼šæº–å‚™æ›´æ–°')
                        })
                        
                        onUpdated(() => {
                            addLog('âœ¨ å­çµ„ä»¶ï¼šæ›´æ–°å®Œæˆ')
                        })
                        
                        onBeforeUnmount(() => {
                            addLog('ğŸ”¶ å­çµ„ä»¶ï¼šæº–å‚™å¸è¼‰')
                        })
                        
                        onUnmounted(() => {
                            addLog('âŒ å­çµ„ä»¶ï¼šå·²å¸è¼‰')
                        })
                        
                        return { count }
                    }
                }
            }
        }).mount('#app5')
        
        // ç¯„ä¾‹ 6ï¼šè¤‡é›œç”Ÿå‘½é€±æœŸçµ„åˆ
        createApp({
            template: `
                <div>
                    <h4>è¤‡é›œå ´æ™¯æ¨¡æ“¬</h4>
                    <p>ç¶²è·¯ç‹€æ…‹ï¼š{{ isOnline ? 'ğŸŸ¢ åœ¨ç·š' : 'ğŸ”´ é›¢ç·š' }}</p>
                    <p>æ•¸æ“šé …ç›®ï¼š{{ data.length }} å€‹</p>
                    <button @click="addData">ğŸ“ æ·»åŠ æ•¸æ“š</button>
                    <button @click="clearData">ğŸ—‘ï¸ æ¸…ç©ºæ•¸æ“š</button>
                    
                    <div style="margin-top: 10px;">
                        <h5>ğŸ“Š æ•¸æ“šåˆ—è¡¨ï¼š</h5>
                        <ul v-if="data.length > 0">
                            <li v-for="item in data" :key="item.id">
                                {{ item.name }} - {{ item.timestamp }}
                            </li>
                        </ul>
                        <p v-else style="color: #999;">æš«ç„¡æ•¸æ“š</p>
                    </div>
                </div>
            `,
            setup() {
                const data = ref([])
                const isOnline = ref(navigator.onLine)
                let idCounter = 1
                
                function handleOnline() {
                    isOnline.value = true
                    console.log('ğŸŒ ç¶²è·¯å·²é€£æ¥')
                }
                
                function handleOffline() {
                    isOnline.value = false
                    console.log('ğŸŒ ç¶²è·¯å·²æ–·é–‹')
                }
                
                function addData() {
                    data.value.push({
                        id: idCounter++,
                        name: `æ•¸æ“šé …ç›® ${idCounter - 1}`,
                        timestamp: new Date().toLocaleTimeString()
                    })
                }
                
                function clearData() {
                    data.value = []
                }
                
                onMounted(() => {
                    // ç¶²è·¯ç‹€æ…‹ç›£è½
                    window.addEventListener('online', handleOnline)
                    window.addEventListener('offline', handleOffline)
                    console.log('ğŸ”Œ å·²åˆå§‹åŒ–æ‰€æœ‰ç›£è½å™¨')
                    
                    // åˆå§‹åŒ–ä¸€äº›æ•¸æ“š
                    addData()
                    addData()
                })
                
                onUpdated(() => {
                    console.log('ğŸ“± UI å·²æ›´æ–°ï¼Œæ•¸æ“šé …ç›®æ•¸:', data.value.length)
                })
                
                onUnmounted(() => {
                    window.removeEventListener('online', handleOnline)
                    window.removeEventListener('offline', handleOffline)
                    console.log('ğŸ§¹ æ‰€æœ‰ç›£è½å™¨å·²æ¸…ç†')
                })
                
                return { 
                    data, 
                    isOnline, 
                    addData, 
                    clearData 
                }
            }
        }).mount('#app6')
    </script>
</body>
</html>